<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="https://www.thymeleaf.org">
<head>
<title>Evento seleccionado</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="https://kit.fontawesome.com/adb5bd4540.js"
	crossorigin="anonymous"></script>

</head>
<body class="bg-info" style="height: 100vh">
	<div th:insert="fragmentos :: navbar"></div>
	<div class="container">

		<div th:if="${__${@atributos.SALAS}__}">
			<script th:inline="javascript">
				function mostrarModal() {
					$('#modal_sala').modal('show');
				}
			</script>
			<div th:insert="fragmentos :: modal_sala"></div>

		</div>

		<div class="card bg-light">
			<div class="card-header">
				<h1 class="text-success px-5 mx-5">
					<strong>Evento seleccionado</strong>
				</h1>
				<label th:text="${tsActual}"></label>
			</div>
			</br>
			<div class="card-body">
				<form th:action="@{/Evento/confirmar}" method="post"
					th:object="${eventoSeleccionado}">

					<table style="table-layout: fixed; width: 100%"
						class="table table-striped">
						<tbody>
							<tr rowspan="2">
								<!-- 									<td> -->
								<input type="hidden" th:field="*{idEvento}">
								<!-- 									</td> -->
							</tr>
							<tr>
								<td><label style="color: #007bff;">Nombre:</label></td>
								<td colspan="3" style="word-wrap: break-word"
									th:text="*{nombre}" readonly></td>
							</tr>

							<tr>
								<td><label style="color: #007bff;">Usuario Creador:</label></td>
								<td th:text="*{UsuarioCreador.username}" readonly></td>

								<td><label style="color: #007bff;">Sala:</label></td>
								<td>
									<button type="button" id="idSalaTooltip"
										class="btn btn-outline-secondary"
										th:text="*{salaEvento.idSala}"
										title="${eventoSeleccionado.idEvento}"
										onclick="mostrarModal()"></button>
								</td>
							</tr>
							<tr>
								<td><label style="color: #007bff;">Presencial:</label></td>
								<td><input type="checkbox" th:name="checkPresencial"
									class="form-check-input"
									th:checked="${usuarioEventoSeleccionado.isPresencial()}" /></td>

								<td><label style="color: #007bff;">Asistencia
										confirmada:</label></td>
								<td><input type="checkbox" name="checkAsistente"
									class="form-check" 
									th:checked="${usuarioEventoSeleccionado.asistente}" disabled />
								</td>
							</tr>
							<tr>
								<div
									th:if="${usuarioEventoSeleccionado.horario== null && eventoSeleccionado.horarioElegido== null}">

									<td colspan="1"><label style="color: #007bff;">Opciones
											de horario:</label></td>
									<td colspan="3">

										<ul>
											<li th:each="horarioDisponible: *{lstHorarios}" th:name="bua">

												<input type="radio" th:name="seleccionHorario"
												th:value="${horarioDisponible.idHorario}" checked="checked" />
												<label for="${horarioDisponible.idHorario}"
												th:text="${' Comienzo: ' + #dates.format(horarioDisponible.Horario_Fecha_Inicio, 'dd-MM-yyyy HH:mm') + ' Fin: ' + #dates.format(horarioDisponible.Horario_Fecha_Fin, 'dd-MM-yyyy HH:mm')}"></label>

											</li>
										</ul>
									</td>
								</div>
								<div th:unless="${eventoSeleccionado.horarioElegido == null}">
									<td><label style="color: #007bff;">Horario elegido
											Inicio:</label></td>
									<td
										th:text="${#dates.format(eventoSeleccionado.horarioElegido.Horario_Fecha_Inicio, 'dd-MM-yyyy HH:mm')}"
										readonly></td>

									<td><label style="color: #007bff;">Horario elegido
											Fin:</label></td>
									<td
										th:text="${#dates.format(eventoSeleccionado.horarioElegido.Horario_Fecha_Fin, 'dd-MM-yyyy HH:mm')}"
										readonly></td>
								</div>
							</tr>

						</tbody>
						<tfoot>
							</br>

							<tr
								th:if="${eventoSeleccionado.UsuarioCreador.idUsuario != userLogin.idUsuario && eventoSeleccionado.horarioElegido == null && usuarioEventoSeleccionado.horario== null}">
								<td colspan="2"><a
									th:href="@{baja?id=} + ${eventoSeleccionado.idEvento}"
									class="btn btn-primary btn-block">Darme de Baja</a></td>

								<td colspan="2">
									<button class="btn btn-primary btn-block" type="submit">Confirmar</button>

								</td>
							</tr>

							<tr
								th:if="${eventoSeleccionado.UsuarioCreador.idUsuario == userLogin.idUsuario}">
								<td colspan="1"><label style="color: #007bff;">Inscritos
										al evento:</label></td>
								<td colspan="3"
									th:text="${eventoSeleccionado.getTotalConfirmadosEvento()+ ' de un total de ' + eventoSeleccionado.getEventosDelUsuarioTotal()}"></td>

							</tr>
							<tr
								th:if="${eventoSeleccionado.UsuarioCreador.idUsuario == userLogin.idUsuario}">
								<td><label style="color: #007bff;">Total Asistentes
										confirmados:</label></td>
								<td><label
									th:text="${eventoSeleccionado.getTotalAsistentesEvento()}"></label></td>

								<td><label style="color: #007bff;">Total Lista de
										Espera:</label></td>
								<td><label
									th:text="${eventoSeleccionado.getTotalListaEsperaEvento()}"></label></td>
							</tr>
							<tr
								th:if="${eventoSeleccionado.UsuarioCreador.idUsuario == userLogin.idUsuario}">
								<td><label style="color: #007bff;"> Horario mas	votado (actual):</label></td>
								<td colspan="3"><label
									th:text="${horarioVotado == null ? 'Sin confirmaciones' : #dates.format(horarioVotado.Horario_Fecha_Inicio, 'dd-MM-yyyy HH:mm')}" /></td>
							</tr>

						</tfoot>
					</table>
				</form>
				<div
					th:if="${eventoSeleccionado.UsuarioCreador.idUsuario == userLogin.idUsuario}">

					<!-- NO BORRAR ES LA LINEA BUENA				<div th:if="${eventoSeleccionado.UsuarioCreador.idUsuario == userLogin.idUsuario && eventoSeleccionado.horarioElegido.Horario_Fecha_Inicio > tsActual}">    				 -->
					<form style="width: 100%"
						th:action="@{/Evento/confirmarAsistenciaEvento}" method="post"
						th:object="${eventoSeleccionado}">

						<input type="hidden" th:name="horarioVotado"
							th:value="${horarioVotado == null? null :horarioVotado.idHorario}" />
						<input type="hidden" th:name="checkAsistenteElegido" />	
							
						<input type="hidden" th:name="eventoSeleccionado" th:value="${eventoSeleccionado.idEvento}" />								

						<table style="table-layout: fixed; width: 100%"
							class="table table-striped justify-content-center">
							<thead bgcolor="#79df91">
								<tr>
									<td colspan="4"><label style="color: #007bff;">
											Listado de Asistentes al evento:</label></td>
								</tr>
							</thead>
							<tbody>
								<tr
									th:each="usuariosInvitados : ${eventoSeleccionado.getEventosDelUsuario()}">
									<td><label
										th:text="${usuariosInvitados.usuario.username}"></label></td>
									<td><label
										th:text="${usuariosInvitados.usuario.nombre}"></label></td>
									<td><label
										th:text="${usuariosInvitados.usuario.apellidos != null ? usuariosInvitados.usuario.apellidos:''}"></label></td>
									<td><input type="checkbox"
										th:value="${usuariosInvitados.idUsuarioEvento}"
										th:name="checkAsistenteElegido" class="form-check"
										th:checked="${usuariosInvitados.asistente}" /></td>
								</tr>
							</tbody>
							<tfoot>
								<tr>
									<td colspan="2"><button class="btn btn-primary btn-lg btn-block"
											type="submit">Confirmar asistentes y horario</button></td>
									<td colspan="2"><a
										th:href="@{cambiarSala?idEv=}+ ${eventoSeleccionado.idEvento}"
										class="btn btn-primary btn-lg btn-block">Cambiar de sala</a></td>
								</tr>
							</tfoot>
						</table>						
					</form>
				</div>
			</div>
		</div>
	</div>
</body>
</html>